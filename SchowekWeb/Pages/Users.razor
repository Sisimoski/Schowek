@page "/Users"

@using System.Security.Claims
@using Microsoft.AspNetCore.Identity
@using SchowekWeb.Data
@inject UserManager<AspNetUsers> userManager
@inject ApplicationDbContext DbContext
@inject AuthenticationStateProvider AuthenticationStateProvider
@inject Microsoft.AspNetCore.Http.IHttpContextAccessor _httpContextAccessor

<Navbar />
<!-- Content Wrapper. Contains page content -->
<div class="content-wrapper">
    <div class="content-header">
        <div class="container-fluid">
            <div class="row mb-2">

            </div>
        </div>
    </div>

    <div class="content">
        <div class="container-fluid">
            <div class="row">
                <AuthorizeView>
                    <h3>Użytkownicy</h3>

                    <h4>Aktualnie zalogowany użytkownik:</h4>
                    <p>Id: @UserId</p>
                    <p>Id: @context.User.FindFirstValue(ClaimTypes.NameIdentifier)</p>

                    <table class="table">
                        <thead>
                            <tr>
                                <th scope="col">#Id</th>
                                <th scope="col">Username</th>
                                <th scope="col">Email</th>
                                <th scope="col">Imię</th>
                                <th scope="col">Nazwisko</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var user in UsersList)
                            {
                                <tr>
                                    <td>@user.Id</td>
                                    <td>@user.UserName</td>
                                    <td>@user.Email</td>
                                    <td>@user.FirstName</td>
                                    <td>@user.LastName</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </AuthorizeView>
            </div>
        </div>
    </div>
</div>

@code {
    //Users List Property
    private List<AspNetUsers> UsersList { get; set; }

    public string UserId { get; set; }

    protected override void OnInitialized()
    {
        UsersList = DbContext.Users.ToList<AspNetUsers>();

        UserId = _httpContextAccessor.HttpContext.User.FindFirst(ClaimTypes.NameIdentifier).Value;
    }

    @*protected override async Task OnInitializedAsync()
        {
            await GetCurrentUserIdData();
        }

        private async Task GetCurrentUserIdData()
        {
            var authState = await AuthenticationStateProvider.GetAuthenticationStateAsync();
            var user = authState.User;
            UserId = authState.User.FindFirstValue(ClaimTypes.NameIdentifier);
        }*@
}
